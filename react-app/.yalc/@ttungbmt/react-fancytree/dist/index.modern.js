import e,{useState as t,useCallback as r,memo as i,useRef as l,useEffect as n}from"react";import a from"clsx";import o,{mapValues as s,mapKeys as d,keys as c}from"lodash";import p from"jquery";import"jquery-ui";import"jquery.fancytree";import"jquery.fancytree/dist/modules/jquery.fancytree.filter";import"jquery.fancytree/dist/modules/jquery.fancytree.glyph";import u from"constate";import{useImmerReducer as m}from"use-immer";import"immer";import{toTree as f}from"@ttungbmt/tree-js";function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function h(e,t){if(null==e)return{};var r,i,l={},n=Object.keys(e);for(i=0;i<n.length;i++)t.indexOf(r=n[i])>=0||(l[r]=e[r]);return l}const g={loading:!1,ids:[],entities:{}},x={setLoading:(e,{payload:t})=>e.loading=t,setAll:(e,{payload:t})=>{e.entities=d(t,"id"),(e=>{e.ids=c(e.entities)})(e)},select:(e,{payload:t})=>{t.ids.map(r=>e.entities[r].selected=t.selected)},selectOne:(e,{payload:{ids:t,selected:r,siblingIds:i}})=>{i.map(t=>e.entities[t].selected=!r),t.map(t=>e.entities[t].selected=r)},setExpand:(e,{payload:t})=>{e.entities[t]&&(e.entities[t].expanded=!0)},setCollapse:(e,{payload:t})=>{e.entities[t]&&(e.entities[t].expanded=!1)}},v=(e,t)=>{x[t.type](e,t)},[b,E]=u(function(){const[e,i]=m(v,g),[l,n]=t(void 0),a=r(()=>y({},s(x,(e,t)=>e=>i({type:t,payload:e})),{expandAll:()=>l.expandAll(),collapseAll:()=>l.expandAll(!1),toggleExpandAll:()=>l.visit(e=>e.toggleExpanded())}),[l]);return y({},a(),{tree:l,setTree:n,dispatch:i,source:f(e.ids.map(t=>e.entities[t]))})}),j=["blurTree","create","init","focusTree","restore","activate","beforeActivate","beforeExpand","beforeSelect","blur","click","collapse","createNode","dblclick","deactivate","expand","focus","keydown","keypress","lazyLoad","loadChildren","loadError","postProcess","modifyChild","renderNode","renderTitle","select"],A=(t,r)=>{if(o.isArray(t))return t.map((e,t)=>A(e,t+1));const{children:i,tooltip:l,title:n,data:s={}}=t,d=h(t,["children","tooltip","title","count","data"]),c=o.isNil(d.folder)?o.isArray(i)&&!o.isEmpty(i):d.folder;return e.createElement("li",{key:r,id:"ft"+r,title:l,className:a("relative",{folder:c}),"data-json":JSON.stringify(y({},d,s))},n,o.isArray(i)?e.createElement("ul",null,i.map((e,t)=>A(e,r+"."+(t+1)))):null)};function k(t){let{id:r,style:i,className:s,children:d,source:c}=t,u=h(t,["id","style","className","children","source"]);const m=l(null);return function(e,t){const{setTree:r}=E(),i=o.omit(t.options,j)||{};n(()=>{if(e.current){let l=(e=>o.chain(j).mapKeys(e=>e).mapValues(t=>(...r)=>{let i=`on${o.upperFirst(t)}`;e[i]&&e[i](...r)}).value())(t);p(e.current).fancytree(y({},l,i,{renderNode:function(e,{node:t}){let r=p(t.span).find(".label-feature-count"),i=t.data.count;i&&!r.length&&p(t.span).append(p(`<div class="label-feature-count">${i}</div>`))}})),r(p.ui.fancytree.getTree(e.current))}},[])}(m,u),e.createElement("div",{id:r,className:a(s),style:i,ref:m},d||e.createElement("ul",{style:{display:"none"}},A(c)))}k.defaultProps={options:{checkbox:!0,selectMode:3,quicksearch:!0,icon:!0,clickFolderMode:3,checkboxAutoHide:!1,disabled:!1,wide:{iconWidth:"3em",iconSpacing:"0.5em",labelSpacing:"0.1em",levelOfs:"1.5em"},filter:{autoApply:!0,autoExpand:!1,counter:!0,fuzzy:!1,hideExpandedCounter:!0,hideExpanders:!1,highlight:!0,leavesOnly:!1,nodata:!0,mode:"dimm"},childcounter:{deep:!0,hideZeros:!0,hideExpanded:!0},extensions:["filter"]}};var N=i(k);const O=e=>{if(e.isFolder()){let t=[];return e.visit(e=>{!e.isFolder()&&t.push(e)}),t}return[e]};export{N as FancyTree,b as TreeProvider,O as getToggleFiles,E as useTreeContext};
//# sourceMappingURL=index.modern.js.map
